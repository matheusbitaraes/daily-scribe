# Development Caddyfile for Daily Scribe
# Global configuration must be first

{
	# Admin API on all interfaces for development
	admin 0.0.0.0:2019
	
	# Use internal certificates for localhost
	local_certs
	
	# Debug mode
	debug
}

# Main site configuration
localhost:80, localhost:443 {
	# Local development with self-signed certificates
	tls internal
	
	# Reverse proxy to the app container
	reverse_proxy app:8000 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
	}
	
	# Development-friendly CORS headers
	header {
		Access-Control-Allow-Origin "*"
		Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
		Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
		X-Content-Type-Options "nosniff"
	}
	
	# Handle preflight requests
	@options method OPTIONS
	respond @options 204
	
	# Development logging to stdout
	log {
		output stdout
		format console
		level DEBUG
	}
}

# Health check endpoint
:8080 {
	respond /health "OK" 200
}
